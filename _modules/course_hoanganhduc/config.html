<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>course_hoanganhduc.config &#8212; Course Management Toolkit 0.1.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../../_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=27fed22d" />
    <script src="../../_static/documentation_options.js?v=a58bc63e"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for course_hoanganhduc.config</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Configuration helpers.&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">platform</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.settings</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">append_run_report</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_normalize_course_code</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_prompt_course_code</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Prompt the user for a course code with a timeout.&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_read</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Enter course code (e.g., MAT3500): &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">EOFError</span><span class="p">,</span> <span class="ne">KeyboardInterrupt</span><span class="p">):</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">_read</span><span class="p">,</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">thread</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">thread</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>

<span class="k">def</span><span class="w"> </span><span class="nf">_course_code_marker_path</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s2">&quot;.course_code&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_load_cached_course_code</span><span class="p">():</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">_course_code_marker_path</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_save_cached_course_code</span><span class="p">(</span><span class="n">course_code</span><span class="p">):</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">_course_code_marker_path</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">course_code</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
        <span class="k">pass</span>


<div class="viewcode-block" id="cache_course_code">
<a class="viewcode-back" href="../../api.html#course_hoanganhduc.config.cache_course_code">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">cache_course_code</span><span class="p">(</span><span class="n">course_code</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Persist a normalized course code in the local .course_code cache.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">course_code</span> <span class="o">=</span> <span class="n">_normalize_course_code</span><span class="p">(</span><span class="n">course_code</span><span class="p">)</span> <span class="ow">or</span> <span class="n">_normalize_course_code</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;COURSE_CODE&quot;</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">course_code</span><span class="p">:</span>
        <span class="n">_save_cached_course_code</span><span class="p">(</span><span class="n">course_code</span><span class="p">)</span></div>



<div class="viewcode-block" id="get_cached_course_code">
<a class="viewcode-back" href="../../api.html#course_hoanganhduc.config.get_cached_course_code">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_cached_course_code</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the cached course code from .course_code if available.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_normalize_course_code</span><span class="p">(</span><span class="n">_load_cached_course_code</span><span class="p">())</span></div>



<div class="viewcode-block" id="get_default_config_path">
<a class="viewcode-back" href="../../api.html#course_hoanganhduc.config.get_default_config_path">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_default_config_path</span><span class="p">(</span><span class="n">course_code</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the default config file path for the current operating system.</span>
<span class="sd">    The course_code controls the subfolder name under the base config directory.</span>
<span class="sd">    - Windows: %APPDATA%\course\&lt;course_code&gt;\config.json</span>
<span class="sd">    - macOS: ~/Library/Application Support/course/&lt;course_code&gt;/config.json</span>
<span class="sd">    - Linux: ~/.config/course/&lt;course_code&gt;/config.json</span>
<span class="sd">    If verbose is True, print details about the chosen path.</span>
<span class="sd">    Otherwise, print only an important notice if the config file does not exist.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">course_code</span> <span class="o">=</span> <span class="n">_normalize_course_code</span><span class="p">(</span><span class="n">course_code</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">course_code</span><span class="p">:</span>
        <span class="n">course_code</span> <span class="o">=</span> <span class="n">_normalize_course_code</span><span class="p">(</span><span class="n">_load_cached_course_code</span><span class="p">())</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">course_code</span><span class="p">:</span>
        <span class="n">course_code</span> <span class="o">=</span> <span class="n">_normalize_course_code</span><span class="p">(</span><span class="n">_prompt_course_code</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">course_code</span><span class="p">:</span>
            <span class="n">_save_cached_course_code</span><span class="p">(</span><span class="n">course_code</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">course_code</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Config] A course code is required to run this script. Exiting.&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">system</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">system</span> <span class="o">==</span> <span class="s2">&quot;windows&quot;</span><span class="p">:</span>
        <span class="n">appdata</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;APPDATA&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()))</span>
        <span class="n">config_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">appdata</span><span class="p">,</span> <span class="s2">&quot;course&quot;</span><span class="p">,</span> <span class="n">course_code</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">system</span> <span class="o">==</span> <span class="s2">&quot;darwin&quot;</span><span class="p">:</span>  <span class="c1"># macOS</span>
        <span class="n">config_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()),</span> <span class="s2">&quot;Library&quot;</span><span class="p">,</span> <span class="s2">&quot;Application Support&quot;</span><span class="p">,</span> <span class="s2">&quot;course&quot;</span><span class="p">,</span> <span class="n">course_code</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Linux and others</span>
        <span class="n">config_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()),</span> <span class="s2">&quot;.config&quot;</span><span class="p">,</span> <span class="s2">&quot;course&quot;</span><span class="p">,</span> <span class="n">course_code</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">config_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_dir</span><span class="p">,</span> <span class="s2">&quot;config.json&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Config] OS detected: </span><span class="si">{</span><span class="n">system</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Config] Config directory: </span><span class="si">{</span><span class="n">config_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Config] Config file path: </span><span class="si">{</span><span class="n">config_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config_path</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Config] Notice: Config file does not exist yet. You may need to create </span><span class="si">{</span><span class="n">config_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config_path</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Notice: Config file not found at </span><span class="si">{</span><span class="n">config_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">config_path</span></div>



<div class="viewcode-block" id="get_default_credentials_path">
<a class="viewcode-back" href="../../api.html#course_hoanganhduc.config.get_default_credentials_path">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_default_credentials_path</span><span class="p">(</span><span class="n">course_code</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the default credentials file path alongside the config file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">config_path</span> <span class="o">=</span> <span class="n">get_default_config_path</span><span class="p">(</span><span class="n">course_code</span><span class="o">=</span><span class="n">course_code</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">config_path</span><span class="p">),</span> <span class="s2">&quot;credentials.json&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="get_default_token_path">
<a class="viewcode-back" href="../../api.html#course_hoanganhduc.config.get_default_token_path">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_default_token_path</span><span class="p">(</span><span class="n">course_code</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the default token file path alongside the config file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">config_path</span> <span class="o">=</span> <span class="n">get_default_config_path</span><span class="p">(</span><span class="n">course_code</span><span class="o">=</span><span class="n">course_code</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">config_path</span><span class="p">),</span> <span class="s2">&quot;token.pickle&quot;</span><span class="p">)</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_safe_remove</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Config] </span><span class="si">{</span><span class="n">label</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;path&#39;</span><span class="si">}</span><span class="s2"> not set; nothing to remove.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Config] Failed to remove </span><span class="si">{</span><span class="n">label</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;file&#39;</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Config] Removed </span><span class="si">{</span><span class="n">label</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;file&#39;</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Config] </span><span class="si">{</span><span class="n">label</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;file&#39;</span><span class="si">}</span><span class="s2"> not found at </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">False</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_copy_file_to_default</span><span class="p">(</span><span class="n">src_path</span><span class="p">,</span> <span class="n">dest_path</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">src_path</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">src_path</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">src_path</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Config] </span><span class="si">{</span><span class="n">label</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;file&#39;</span><span class="si">}</span><span class="s2"> not found at </span><span class="si">{</span><span class="n">src_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">src_path</span><span class="p">)</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">dest_path</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dest_path</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">dest_path</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">DRY_RUN</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Config] Dry run: would copy </span><span class="si">{</span><span class="n">label</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;file&#39;</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">src_path</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">dest_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dest_path</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">src_path</span><span class="p">,</span> <span class="n">dest_path</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Config] Failed to copy </span><span class="si">{</span><span class="n">label</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;file&#39;</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">dest_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Config] Copied </span><span class="si">{</span><span class="n">label</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;file&#39;</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">dest_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dest_path</span>


<span class="k">def</span><span class="w"> </span><span class="nf">sync_config_to_default</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">course_code</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">config_path</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config_path</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">get_default_config_path</span><span class="p">(</span><span class="n">course_code</span><span class="o">=</span><span class="n">course_code</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">default_path</span> <span class="o">=</span> <span class="n">get_default_config_path</span><span class="p">(</span><span class="n">course_code</span><span class="o">=</span><span class="n">course_code</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">copied_path</span> <span class="o">=</span> <span class="n">_copy_file_to_default</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="n">default_path</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;config file&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">copied_path</span> <span class="ow">or</span> <span class="n">default_path</span>


<span class="k">def</span><span class="w"> </span><span class="nf">sync_credentials_to_default</span><span class="p">(</span><span class="n">credentials_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">token_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">course_code</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">default_credentials</span> <span class="o">=</span> <span class="n">get_default_credentials_path</span><span class="p">(</span><span class="n">course_code</span><span class="o">=</span><span class="n">course_code</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">default_token</span> <span class="o">=</span> <span class="n">get_default_token_path</span><span class="p">(</span><span class="n">course_code</span><span class="o">=</span><span class="n">course_code</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">credentials_path</span><span class="p">:</span>
        <span class="n">_copy_file_to_default</span><span class="p">(</span><span class="n">credentials_path</span><span class="p">,</span> <span class="n">default_credentials</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;credentials file&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">token_path</span><span class="p">:</span>
        <span class="n">_copy_file_to_default</span><span class="p">(</span><span class="n">token_path</span><span class="p">,</span> <span class="n">default_token</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;token file&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;credentials_path&quot;</span><span class="p">:</span> <span class="n">default_credentials</span><span class="p">,</span>
        <span class="s2">&quot;token_path&quot;</span><span class="p">:</span> <span class="n">default_token</span><span class="p">,</span>
    <span class="p">}</span>


<span class="k">def</span><span class="w"> </span><span class="nf">update_config_values</span><span class="p">(</span><span class="n">updates</span><span class="p">,</span> <span class="n">course_code</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">updates</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">updates</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">config_path</span> <span class="o">=</span> <span class="n">get_default_config_path</span><span class="p">(</span><span class="n">course_code</span><span class="o">=</span><span class="n">course_code</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">config_data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config_path</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">config_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">config_data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">config_data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">updates</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">DRY_RUN</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Config] Dry run: would update config at </span><span class="si">{</span><span class="n">config_path</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="n">updates</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">config_path</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">config_data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Config] Failed to update config at </span><span class="si">{</span><span class="n">config_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Config] Updated config at </span><span class="si">{</span><span class="n">config_path</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="n">updates</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">config_path</span>


<div class="viewcode-block" id="clear_config">
<a class="viewcode-back" href="../../api.html#course_hoanganhduc.config.clear_config">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">clear_config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">course_code</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove the stored config file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">config_path</span><span class="p">:</span>
        <span class="n">config_path</span> <span class="o">=</span> <span class="n">get_default_config_path</span><span class="p">(</span><span class="n">course_code</span><span class="o">=</span><span class="n">course_code</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_safe_remove</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;config file&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span></div>



<div class="viewcode-block" id="clear_credentials">
<a class="viewcode-back" href="../../api.html#course_hoanganhduc.config.clear_credentials">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">clear_credentials</span><span class="p">(</span><span class="n">credentials_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">token_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">course_code</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove stored credentials and token files.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">credentials_path</span><span class="p">:</span>
        <span class="n">credentials_path</span> <span class="o">=</span> <span class="n">get_default_credentials_path</span><span class="p">(</span><span class="n">course_code</span><span class="o">=</span><span class="n">course_code</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">token_path</span><span class="p">:</span>
        <span class="n">token_path</span> <span class="o">=</span> <span class="n">get_default_token_path</span><span class="p">(</span><span class="n">course_code</span><span class="o">=</span><span class="n">course_code</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;credentials&quot;</span><span class="p">:</span> <span class="n">_safe_remove</span><span class="p">(</span><span class="n">credentials_path</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;credentials file&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">),</span>
        <span class="s2">&quot;token&quot;</span><span class="p">:</span> <span class="n">_safe_remove</span><span class="p">(</span><span class="n">token_path</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;token file&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">),</span>
    <span class="p">}</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_list_backups</span><span class="p">(</span><span class="n">backup_dir</span><span class="p">,</span> <span class="n">base_name</span><span class="p">,</span> <span class="n">ext</span><span class="p">):</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">backup_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">_backup_*</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pattern</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_cleanup_backups</span><span class="p">(</span><span class="n">backup_dir</span><span class="p">,</span> <span class="n">base_name</span><span class="p">,</span> <span class="n">ext</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">keep</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">keep</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">keep</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="n">backups</span> <span class="o">=</span> <span class="n">_list_backups</span><span class="p">(</span><span class="n">backup_dir</span><span class="p">,</span> <span class="n">base_name</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">keep</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">backups</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">keep</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="n">to_remove</span> <span class="o">=</span> <span class="n">backups</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">backups</span><span class="p">)</span> <span class="o">-</span> <span class="n">keep</span><span class="p">]</span>
    <span class="n">removed</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="n">removed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ConfigBackup] Failed to remove old backup </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">removed</span>


<span class="k">def</span><span class="w"> </span><span class="nf">backup_config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">backup_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">course_code</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">config_path</span><span class="p">:</span>
        <span class="n">config_path</span> <span class="o">=</span> <span class="n">get_default_config_path</span><span class="p">(</span><span class="n">course_code</span><span class="o">=</span><span class="n">course_code</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config_path</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ConfigBackup] Config not found at </span><span class="si">{</span><span class="n">config_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Config not found at </span><span class="si">{</span><span class="n">config_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">backup_dir</span> <span class="o">=</span> <span class="n">backup_dir</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;.&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">backup_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">config_path</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">config_path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">now_str</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">_%H%M%S&quot;</span><span class="p">)</span>
    <span class="n">backup_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">backup_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base</span><span class="si">}</span><span class="s2">_backup_</span><span class="si">{</span><span class="n">now_str</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">DRY_RUN</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ConfigBackup] Dry run: would back up config to </span><span class="si">{</span><span class="n">backup_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">backup_path</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="n">backup_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ConfigBackup] Backed up config to </span><span class="si">{</span><span class="n">backup_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Config backup created at </span><span class="si">{</span><span class="n">backup_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">append_run_report</span><span class="p">(</span><span class="s2">&quot;backup-config&quot;</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">backup_path</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ConfigBackup] Failed to back up config: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">_cleanup_backups</span><span class="p">(</span><span class="n">backup_dir</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">ext</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="n">keep</span> <span class="k">if</span> <span class="n">keep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">CONFIG_BACKUP_KEEP</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">backup_path</span>


<span class="k">def</span><span class="w"> </span><span class="nf">restore_config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">backup_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">course_code</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">config_path</span><span class="p">:</span>
        <span class="n">config_path</span> <span class="o">=</span> <span class="n">get_default_config_path</span><span class="p">(</span><span class="n">course_code</span><span class="o">=</span><span class="n">course_code</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">backup_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;.&quot;</span>
    <span class="n">base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">config_path</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">config_path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">backup_path</span> <span class="ow">or</span> <span class="n">backup_path</span> <span class="o">==</span> <span class="s2">&quot;latest&quot;</span><span class="p">:</span>
        <span class="n">backups</span> <span class="o">=</span> <span class="n">_list_backups</span><span class="p">(</span><span class="n">backup_dir</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">backups</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No config backups found.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">backup_path</span> <span class="o">=</span> <span class="n">backups</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">backup_path</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Config backup not found: </span><span class="si">{</span><span class="n">backup_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">DRY_RUN</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ConfigBackup] Dry run: would restore config from </span><span class="si">{</span><span class="n">backup_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">backup_path</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">backup_path</span><span class="p">,</span> <span class="n">config_path</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ConfigBackup] Failed to restore config: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ConfigBackup] Restored config from </span><span class="si">{</span><span class="n">backup_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Config restored from </span><span class="si">{</span><span class="n">backup_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">append_run_report</span><span class="p">(</span><span class="s2">&quot;restore-config&quot;</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">backup_path</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">backup_path</span>


<div class="viewcode-block" id="load_config">
<a class="viewcode-back" href="../../api.html#course_hoanganhduc.config.load_config">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">load_config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load configuration from a JSON or base64-encoded JSON file at the default location and return config values as a dict.</span>
<span class="sd">    If config_path is not provided, loads from the OS-specific default location.</span>
<span class="sd">    config_path can be a file path (JSON or base64-encoded JSON) or a base64 string.</span>
<span class="sd">    Returns a dict of the loaded config values (does NOT set global variables).</span>
<span class="sd">    If verbose is True, print more details; otherwise, print only important notice.</span>

<span class="sd">    NOTE: If you want to update global variables, you must set:</span>
<span class="sd">        DEFAULT_AI_METHOD</span>
<span class="sd">        ALL_AI_METHODS</span>
<span class="sd">        GEMINI_API_KEY</span>
<span class="sd">        HUGGINGFACE_API_KEY</span>
<span class="sd">        GEMINI_DEFAULT_MODEL</span>
<span class="sd">        DEFAULT_OCR_METHOD</span>
<span class="sd">        ALL_OCR_METHODS</span>
<span class="sd">        OCRSPACE_API_KEY</span>
<span class="sd">        OCRSPACE_API_URL</span>
<span class="sd">        LOCAL_LLM_COMMAND</span>
<span class="sd">        LOCAL_LLM_MODEL</span>
<span class="sd">        LOCAL_LLM_ARGS</span>
<span class="sd">        LOCAL_LLM_TIMEOUT</span>
<span class="sd">        CANVAS_LMS_API_URL</span>
<span class="sd">        CANVAS_LMS_API_KEY</span>
<span class="sd">        CANVAS_LMS_COURSE_ID</span>
<span class="sd">        COURSE_CODE</span>
<span class="sd">        COURSE_NAME</span>
<span class="sd">        DEFAULT_RESTRICTED</span>
<span class="sd">        WEIGHT_CC</span>
<span class="sd">        WEIGHT_GK</span>
<span class="sd">        WEIGHT_CK</span>
<span class="sd">        QUALITY_MIN_CHARS</span>
<span class="sd">        QUALITY_UNIQUE_CHAR_RATIO_MIN</span>
<span class="sd">        QUALITY_REPEAT_CHAR_RATIO_MAX</span>
<span class="sd">        QUALITY_VN_CHAR_RATIO_MIN</span>
<span class="sd">        QUALITY_ALNUM_RATIO_MIN</span>
<span class="sd">        QUALITY_SYMBOL_RATIO_MAX</span>
<span class="sd">        QUALITY_EMPTY_LINE_RATIO_MAX</span>
<span class="sd">        QUALITY_MATH_DENSITY_THRESHOLD</span>
<span class="sd">        QUALITY_LENGTH_RATIO_LOW</span>
<span class="sd">        QUALITY_LENGTH_RATIO_MEDIUM</span>
<span class="sd">        QUALITY_LENGTH_RATIO_HIGH</span>
<span class="sd">        MIDTERM_DATE</span>
<span class="sd">        EXAM_TYPE</span>
<span class="sd">        CANVAS_MIDTERM_ASSIGNMENT_ID</span>
<span class="sd">        CANVAS_FINAL_ASSIGNMENT_ID</span>
<span class="sd">        CANVAS_CC_ASSIGNMENT_ID</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">config_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">config_path</span> <span class="o">=</span> <span class="n">get_default_config_path</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">config_data</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">config</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="c1"># Try to treat as a file path first</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config_path</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">config_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="c1"># Try to parse as JSON first</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">config_data</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Config] Parsed as JSON from file: </span><span class="si">{</span><span class="n">config_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="c1"># If not valid JSON, try base64 decode then JSON</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">json_str</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">config_data</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
                        <span class="n">config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_str</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Config] Parsed as base64 JSON from file: </span><span class="si">{</span><span class="n">config_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to parse config file as JSON or base64: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">return</span> <span class="kc">None</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to read config file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Check if it looks like a file path (contains path separators)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="ow">in</span> <span class="n">config_path</span> <span class="ow">or</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;nt&#39;</span> <span class="ow">and</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">config_path</span><span class="p">):</span>
                <span class="c1"># It&#39;s a file path that doesn&#39;t exist, return None</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Config] Config file not found at </span><span class="si">{</span><span class="n">config_path</span><span class="si">}</span><span class="s2">. Using defaults.&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Notice: Config file not found at </span><span class="si">{</span><span class="n">config_path</span><span class="si">}</span><span class="s2">. Using defaults.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Treat as base64 string</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">json_str</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">config_path</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
                    <span class="n">config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_str</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Config] Parsed as base64 JSON from string input.&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to parse config_path as base64 JSON: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid config_path type. Must be str.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">config</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Config] No config data found at </span><span class="si">{</span><span class="n">config_path</span><span class="si">}</span><span class="s2">. Using defaults.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Notice: No config data found at </span><span class="si">{</span><span class="n">config_path</span><span class="si">}</span><span class="s2">. Using defaults.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># Only return config values, do not set globals</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">known_keys</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;CONFIG_VERSION&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CREDENTIALS_PATH&quot;</span><span class="p">,</span>
        <span class="s2">&quot;TOKEN_PATH&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GOOGLE_CLASSROOM_COURSE_ID&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DEFAULT_AI_METHOD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ALL_AI_METHODS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GEMINI_API_KEY&quot;</span><span class="p">,</span>
        <span class="s2">&quot;HUGGINGFACE_API_KEY&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GEMINI_DEFAULT_MODEL&quot;</span><span class="p">,</span>
        <span class="s2">&quot;REPORT_REFINE_METHOD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;LOCAL_LLM_COMMAND&quot;</span><span class="p">,</span>
        <span class="s2">&quot;LOCAL_LLM_MODEL&quot;</span><span class="p">,</span>
        <span class="s2">&quot;LOCAL_LLM_ARGS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;LOCAL_LLM_TIMEOUT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;LOCAL_LLM_GGUF_DIR&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DRY_RUN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;LOG_DIR&quot;</span><span class="p">,</span>
        <span class="s2">&quot;LOG_LEVEL&quot;</span><span class="p">,</span>
        <span class="s2">&quot;LOG_MAX_BYTES&quot;</span><span class="p">,</span>
        <span class="s2">&quot;LOG_BACKUP_COUNT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;STUDENT_SORT_METHOD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DB_BACKUP_KEEP&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CONFIG_BACKUP_KEEP&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GRADE_AUDIT_ENABLED&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GRADE_AUDIT_FIELDS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DEFAULT_OCR_METHOD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ALL_OCR_METHODS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;OCRSPACE_API_KEY&quot;</span><span class="p">,</span>
        <span class="s2">&quot;OCRSPACE_API_URL&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CANVAS_LMS_API_URL&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CANVAS_LMS_API_KEY&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CANVAS_LMS_COURSE_ID&quot;</span><span class="p">,</span>
        <span class="s2">&quot;COURSE_CODE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;COURSE_NAME&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DEFAULT_RESTRICTED&quot;</span><span class="p">,</span>
        <span class="s2">&quot;WEIGHT_CC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;WEIGHT_GK&quot;</span><span class="p">,</span>
        <span class="s2">&quot;WEIGHT_CK&quot;</span><span class="p">,</span>
        <span class="s2">&quot;QUALITY_MIN_CHARS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;QUALITY_UNIQUE_CHAR_RATIO_MIN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;QUALITY_REPEAT_CHAR_RATIO_MAX&quot;</span><span class="p">,</span>
        <span class="s2">&quot;QUALITY_VN_CHAR_RATIO_MIN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;QUALITY_ALNUM_RATIO_MIN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;QUALITY_SYMBOL_RATIO_MAX&quot;</span><span class="p">,</span>
        <span class="s2">&quot;QUALITY_EMPTY_LINE_RATIO_MAX&quot;</span><span class="p">,</span>
        <span class="s2">&quot;QUALITY_MATH_DENSITY_THRESHOLD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;QUALITY_LENGTH_RATIO_LOW&quot;</span><span class="p">,</span>
        <span class="s2">&quot;QUALITY_LENGTH_RATIO_MEDIUM&quot;</span><span class="p">,</span>
        <span class="s2">&quot;QUALITY_LENGTH_RATIO_HIGH&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CANVAS_DEFAULT_ASSIGNMENT_CATEGORY&quot;</span><span class="p">,</span>
        <span class="s2">&quot;MIDTERM_DATE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;EXAM_TYPE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CANVAS_MIDTERM_ASSIGNMENT_ID&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CANVAS_FINAL_ASSIGNMENT_ID&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CANVAS_CC_ASSIGNMENT_ID&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">known_keys</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Config] Configuration loaded from </span><span class="si">{</span><span class="n">config_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Config] </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Configuration loaded from </span><span class="si">{</span><span class="n">config_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="get_default_download_folder">
<a class="viewcode-back" href="../../api.html#course_hoanganhduc.config.get_default_download_folder">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_default_download_folder</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the default download folder for the current operating system.</span>
<span class="sd">    Returns the Downloads folder path appropriate for Windows, Mac, or Linux.</span>
<span class="sd">    If verbose is True, print details about the chosen path.</span>
<span class="sd">    Otherwise, print only an important notice if the folder does not exist.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">system</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">downloads_path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;Downloads&quot;</span>

    <span class="k">if</span> <span class="n">system</span> <span class="o">==</span> <span class="s2">&quot;windows&quot;</span><span class="p">:</span>
        <span class="n">downloads_path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;Downloads&quot;</span>
    <span class="k">elif</span> <span class="n">system</span> <span class="o">==</span> <span class="s2">&quot;darwin&quot;</span><span class="p">:</span>  <span class="c1"># macOS</span>
        <span class="n">downloads_path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;Downloads&quot;</span>
    <span class="k">elif</span> <span class="n">system</span> <span class="o">==</span> <span class="s2">&quot;linux&quot;</span><span class="p">:</span>
        <span class="n">downloads_path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;Downloads&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">downloads_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">downloads_path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;downloads&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">downloads_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">downloads_path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">downloads_path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;Downloads&quot;</span>

    <span class="c1"># Create the folder if it doesn&#39;t exist</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">downloads_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DownloadFolder] OS detected: </span><span class="si">{</span><span class="n">system</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DownloadFolder] Download folder: </span><span class="si">{</span><span class="n">downloads_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DownloadFolder] Could not create Downloads folder: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DownloadFolder] Falling back to home directory: </span><span class="si">{</span><span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">downloads_path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">downloads_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DownloadFolder] Notice: Download folder does not exist at </span><span class="si">{</span><span class="n">downloads_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Notice: Download folder not found at </span><span class="si">{</span><span class="n">downloads_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">downloads_path</span><span class="p">)</span></div>


<span class="k">def</span><span class="w"> </span><span class="nf">get_default_db_path</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s2">&quot;students.db&quot;</span><span class="p">)</span>

<span class="n">DEFAULT_DOWNLOAD_FOLDER</span> <span class="o">=</span> <span class="n">get_default_download_folder</span><span class="p">()</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">Course Management Toolkit</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2026, Duc A. Hoang.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>